# Market Data Tick Handler - Environment Configuration
# Copy this file to .env and update the values for your environment

# =============================================================================
# REQUIRED CONFIGURATION
# =============================================================================

# =============================================================================
# SECRET MANAGER CONFIGURATION (for production services)
# =============================================================================
# When running as a service or package, you can use Google Cloud Secret Manager
# to securely store sensitive configuration like API keys.
#
# Quick Setup:
# 1. Run: ./scripts/setup-secret-manager.sh --project-id YOUR_PROJECT_ID --api-key TD.your_key
# 2. Set USE_SECRET_MANAGER=true below
# 3. For other secrets, use: python scripts/manage-secrets.py --interactive
#
# For local development, keep USE_SECRET_MANAGER=false and use TARDIS_API_KEY
# For detailed instructions, see: docs/SECRET_MANAGER_SETUP.md

# Tardis API Configuration
# Option 1: Use environment variable (for local development)
TARDIS_API_KEY=TD.your_api_key_here

# Option 2: Use Google Cloud Secret Manager (for production services)
# Set USE_SECRET_MANAGER=true to enable Secret Manager integration
USE_SECRET_MANAGER=false
TARDIS_SECRET_NAME=tardis-api-key

TARDIS_BASE_URL=https://datasets.tardis.dev
TARDIS_TIMEOUT=60
TARDIS_MAX_RETRIES=3
TARDIS_MAX_CONCURRENT=50
MAX_PARALLEL_UPLOADS=20

# Google Cloud Platform Configuration
GCP_PROJECT_ID=your-gcp-project-id
GCP_CREDENTIALS_PATH=/path/to/your/service-account-key.json
GCS_BUCKET=your-gcs-bucket-name
GCS_REGION=asia-northeast1-c

# =============================================================================
# OPERATIONAL CONFIGURATION
# =============================================================================

# Service Configuration
LOG_LEVEL=INFO
LOG_DESTINATION=both  # Options: local, gcp, both
MAX_CONCURRENT_REQUESTS=50
BATCH_SIZE=1  # Set to 1 for immediate uploads and better performance
MEMORY_EFFICIENT=true  # Enable memory-efficient mode
ENABLE_CACHING=true
CACHE_TTL=3600

# Rate Limiting
RATE_LIMIT_PER_VM=1000000

# =============================================================================
# PERFORMANCE TUNING (optimized based on analysis)
# =============================================================================

# Download Performance
DOWNLOAD_MAX_WORKERS=2        # 2 workers for Tardis download (leaves 2 vCPUs for system on 4-core VMs)
MAX_PARALLEL_UPLOADS=20       # Parallel GCS uploads (with rate limit awareness)
PARALLEL_DOWNLOADS=4          # Legacy setting (kept for compatibility)

# Memory Management (64GB target for VM deployment)
MAX_MEMORY_USAGE=8GB          # Memory limit for processing
CHUNK_SIZE=1024              # Chunk size for streaming
RETRY_DELAY=5                # Retry delay in seconds

# =============================================================================
# SHARDING CONFIGURATION (for distributed processing)
# =============================================================================

# Shard Configuration (for VM deployment)
SHARD_INDEX=0
TOTAL_SHARDS=30
INSTRUMENTS_PER_SHARD=2

# =============================================================================
# OUTPUT CONFIGURATION
# =============================================================================

# Output Format and Compression
OUTPUT_FORMAT=json
DEFAULT_LIMIT=10000
INCLUDE_METADATA=true
COMPRESSION=snappy

# =============================================================================
# RUNTIME CONFIGURATION
# =============================================================================

# Debug and Testing
DEBUG=false
TEST_MODE=false

# =============================================================================
# MODE-SPECIFIC CONFIGURATION
# =============================================================================

# Instrument Generation Mode
INSTRUMENT_EXCHANGES=binance,binance-futures,deribit,bybit,bybit-spot,okex,okex-futures,okex-swap
INSTRUMENT_START_DATE=2023-05-23
INSTRUMENT_END_DATE=2023-05-25
# Instrument IDs use BASE-QUOTE format (e.g., BINANCE:SPOT_PAIR:BTC-USDT)

# Tick Data Download Mode
DOWNLOAD_VENUES=deribit,binance-futures
DOWNLOAD_INSTRUMENT_TYPES=option,perpetual,spot
DOWNLOAD_DATA_TYPES=trades,book_snapshot_5
DOWNLOAD_MAX_INSTRUMENTS=10

# Query API Mode
QUERY_API_HOST=0.0.0.0
QUERY_API_PORT=8000
QUERY_API_SIGNED_URL_EXPIRY_HOURS=168
QUERY_API_MAX_INSTRUMENTS_PER_QUERY=1000
QUERY_API_MAX_DATE_RANGE_DAYS=365
QUERY_API_ENABLE_STREAMING=true
QUERY_API_MAX_STREAM_SIZE_MB=1000

# =============================================================================
# DOCKER CONFIGURATION
# =============================================================================

# Docker-specific settings
DOCKER_MODE=true
CONTAINER_NAME=market-tick-data-handler
DOCKER_NETWORK=market-data-network

# =============================================================================
# VM DEPLOYMENT CONFIGURATION
# =============================================================================

# VM-specific settings
VM_INSTANCE_NAME=market-data-vm
VM_ZONE=asia-northeast1-c
VM_MACHINE_TYPE=e2-standard-4
VM_DISK_SIZE=100GB
VM_IMAGE_FAMILY=ubuntu-2004-lts

# =============================================================================
# MONITORING AND ALERTING
# =============================================================================

# Monitoring configuration
ENABLE_MONITORING=true
METRICS_ENDPOINT=http://localhost:8080/metrics
ALERT_WEBHOOK_URL=https://hooks.slack.com/your-webhook-url

# =============================================================================
# GOOGLE CLOUD BUILD CONFIGURATION
# =============================================================================

# Enable live streaming of Cloud Build logs
CLOUDSDK_PYTHON_SITEPACKAGES=1

# =============================================================================
# ADVANCED CONFIGURATION
# =============================================================================

# Performance tuning
MAX_MEMORY_USAGE=8GB
PARALLEL_DOWNLOADS=4
DOWNLOAD_MAX_WORKERS=1
CHUNK_SIZE=1024
RETRY_DELAY=5

# Data validation
ENABLE_DATA_VALIDATION=true
VALIDATION_STRICT_MODE=false
MIN_DATA_QUALITY_SCORE=0.8

# =============================================================================
# ENVIRONMENT-SPECIFIC OVERRIDES
# =============================================================================

# Development Environment
# LOG_LEVEL=DEBUG
# TEST_MODE=true
# MAX_CONCURRENT_REQUESTS=1

# Production Environment
# LOG_LEVEL=INFO
# TEST_MODE=false
# MAX_CONCURRENT_REQUESTS=4
# ENABLE_CACHING=true

# Staging Environment
# LOG_LEVEL=WARNING
# TEST_MODE=false
# MAX_CONCURRENT_REQUESTS=2
